"use strict";function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){function t(t,e){var r=[],i=!0,n=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(l){n=!0,s=l}finally{try{!i&&a["return"]&&a["return"]()}finally{if(n)throw s}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}();!function(){var t=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return _classCallCheck(this,t),e||(e={}),this.options=e,this._events={},this}return _createClass(t,[{key:"on",value:function(t,e){if(!t)throw new Error("Event name missing.");if(!e)throw new Error("Event handler missing.");return this._events[t]=this._events[t]||[],-1===this._events[t].indexOf(e)&&this._events[t].push(e),this}},{key:"once",value:function(t,e){var r=function(){this.off(t,r),e.apply(this,arguments)};return r=r.bind(this),r.handler=e,this.on(event,r)}},{key:"off",value:function(t,e){if(!t)throw new Error("Event name missing.");if(!e)throw new Error("Event handler missing.");if(!this._events[t])return this;var r=-1;for(var i in this._events[t])if(this._events[t][i]===e||this._events[t][i].handler===e){r=i;break}return this._events[t].splice(r,1),this}},{key:"trigger",value:function(t,e){if(!this._events[t])return this;var r=!0,i=!1,n=void 0;try{for(var s,o=this._events[t].slice()[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var a=s.value;a.apply(this,e)}}catch(l){i=!0,n=l}finally{try{!r&&o.return&&o.return()}finally{if(i)throw n}}}}]),t}();window.lrs=window.lrs||{},window.lrs.LRSObject=t}(),function(){var t=function(t){function e(t,r){var i;_classCallCheck(this,e);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,r));return n._listeners=[],n.delegateAction=n.delegateAction.bind(n),n.options.owner&&(n.owner=n.options.owner),!n.options.template||t&&0!==t.children.length?n.el=t:(n._loadTemplate(),t&&t.parentNode&&t.parentNode.replaceChild(n.el,t)),n.hidden=n.el.classList.contains("hidden"),n.enabled=!n.el.classList.contains("disabled"),r&&r.delayDomConnectionCreation===!0||n.createDomConnections(),i=n,_possibleConstructorReturn(n,i)}return _inherits(e,t),_createClass(e,null,[{key:"parseTemplates",value:function(){if(!this.templates){this.templates={};var t=!0,e=!1,r=void 0;try{for(var i,n=Array.from(document.querySelectorAll(".templates"))[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var s=i.value;s.parentNode.removeChild(s);var o=document.createElement("div");o.innerHTML=s.innerHTML;var a=!0,l=!1,u=void 0;try{for(var h,c=Array.from(o.children)[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var v=h.value;if(v.hasAttribute("data-template")){var f=v.getAttribute("data-template");v.removeAttribute("data-template"),this.templates[f]=v.outerHTML}}}catch(d){l=!0,u=d}finally{try{!a&&c.return&&c.return()}finally{if(l)throw u}}}}catch(d){e=!0,r=d}finally{try{!t&&n.return&&n.return()}finally{if(e)throw r}}}}}]),_createClass(e,[{key:"createDomConnections",value:function(){if(this._domConnectionsCreated)throw new Error("DOM connections may only be create once.");this._domConnectionsCreated=!0,this._createViews(),this._createOutlets(),this._createActions()}},{key:"_loadTemplate",value:function(){var t=document.createElement("div");return t.innerHTML=this.constructor.templates[this.options.template],this.el=t.firstChild,this}},{key:"_createViews",value:function(){this.views={},this._viewsArray=[];var t=!0,e=!1,r=void 0;try{for(var i,n=Array.from(this.el.querySelectorAll("[data-view]"))[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var s=i.value;if(s.hasAttribute("data-view")){var o=s.getAttribute("data-view").split(":");s.removeAttribute("data-view");var a=void 0,l=void 0;if(1===o.length)a=o[0],l=new lrs.LRSView(s,null);else{a=o[1];var u={owner:this};if(3===o.length)if(this.constructor.views[o[2]+"View"])u.defaultChildClass=this.constructor.views[o[2]+"View"];else{if(!this.constructor.templates[o[2]])throw new Error("View class or template "+o[2]+" used as a default does not exist");u.defaultChildTemplate=o[2]}l=new this.constructor.views[o[0]+"View"](s,u)}this.addView(l,a)}}}catch(h){e=!0,r=h}finally{try{!t&&n.return&&n.return()}finally{if(e)throw r}}return this}},{key:"_createOutlets",value:function(){this.outlets={},this.el.hasAttribute("data-outlet")&&this._createOutlet(this.el);var t=!0,e=!1,r=void 0;try{for(var i,n=Array.from(this.el.querySelectorAll("[data-outlet]"))[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var s=i.value;this._createOutlet(s)}}catch(o){e=!0,r=o}finally{try{!t&&n.return&&n.return()}finally{if(e)throw r}}if(this.customOutlets){var a=!0,l=!1,u=void 0;try{for(var h,c=Object.keys(this.customOutlets)[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var v=h.value;this.outlets[v]=this.customOutlets[v],this.outlets[v].type="custom"}}catch(o){l=!0,u=o}finally{try{!a&&c.return&&c.return()}finally{if(l)throw u}}}return this}},{key:"_createOutlet",value:function(t){var e=this,r=t.getAttribute("data-outlet"),i=(t.tagName||"").toLowerCase();if(this.outlets[r])throw new Error("Duplicate "+r+" outlets");return t.removeAttribute("data-outlet"),("input"===i||"textarea"===i||"select"===i)&&t.addEventListener("change",function(){e.updateOutletFromDom(r)}),this.outlets[r]={el:t,type:i},this.updateOutletFromDom(r),Object.defineProperty(this,r,{configurable:!0,enumerable:!0,get:function(){return this.outlets[r].value},set:function(t){return this.outlets[r].value=t,this.updateDomFromOutlet(r),t}}),this}},{key:"_createActions",value:function(){this.actions={},this.el.hasAttribute("data-action")&&this._createAction(this.el);var t=!0,e=!1,r=void 0;try{for(var i,n=Array.from(this.el.querySelectorAll("[data-action]"))[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var s=i.value;this._createAction(s)}}catch(o){e=!0,r=o}finally{try{!t&&n.return&&n.return()}finally{if(e)throw r}}return this}},{key:"_createAction",value:function(t){var e=this,r=t.getAttribute("data-action").split(";");t.removeAttribute("data-action");var i=!0,n=!1,s=void 0;try{for(var o,a=r[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var l=o.value,u=l.match(this.constructor.actionStringPattern),h=_slicedToArray(u,5),c=h[1],v=h[2],f=h[4],d=f.split(",");1===d.length&&""===d[0]&&(d=[]),this.actions[c]||(this.actions[c]=[]),this.actions[c].push({el:t,name:v,parameters:d}),t.addEventListener(c,function(t){e.delegateAction(t,this)})}}catch(y){n=!0,s=y}finally{try{!i&&a.return&&a.return()}finally{if(n)throw s}}return this}},{key:"delegateAction",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if(this.enabled){var r=this.actions[t.type];if(r){var i=!0,n=!1,s=void 0;try{for(var o,a=r[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var l=o.value;if(null==e||l.el==e){var u=[];for(var h in l.parameters)u.push("null"===h?null:"undefined"==h?void 0:h.charAt(0).match(/['"]/g)&&h.charAt(0)===h.charAt(h.length-1)?h.substring(1,h.length-1):h.match(/^\d*$/)?parseInt(h,10):this[h]);u.push(this,e,t),this.dispatch(l.name+"Action",u)}}}catch(c){n=!0,s=c}finally{try{!i&&a.return&&a.return()}finally{if(n)throw s}}return this}}}},{key:"dispatch",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],r=!0;return this[t]&&"function"==typeof this[t]&&(r=this[t].apply(this,e)),r===!0&&this.owner&&this.owner.dispatch&&this.owner.dispatch(t,e),this}},{key:"updateOutletFromDom",value:function(t){var e=this.outlets[t];return e?(this.outlets[t].value=(this.constructor.outletTypes[e.type]||this.constructor.outletTypes.default).get(e,this),this):this}},{key:"updateDomFromOutlet",value:function(t){var e=this.outlets[t];return e?((this.constructor.outletTypes[e.type]||this.constructor.outletTypes.default).set(e,this,this.outlets[t].value),this):this}},{key:"addView",value:function(t,e){return t.owner?this:(t.owner=this,t._name=e,"view"===e&&(this.view=t),this.views[e]?(Array.isArray(this.views[e])||(this.views[e]=[this.views[e]]),this.views[e].push(t)):this.views[e]=t,void this._viewsArray.push(t))}},{key:"removeView",value:function(t){if(t.owner!=this)return this;var e=this._viewsArray.indexOf(t);if(0>e)return this;if(this._viewsArray.splice(e,1),this.view===t&&delete this.view,Array.isArray(this.views[t.name])){var r=this.views[t.name].indexOf();if(0>r)throw new Error("View not found");this.views[t.name].splice(r,1)}else delete this.views[t.name];return this}},{key:"appendTo",value:function(t,r){return(t.el||t).appendChild(this.el),r&&t instanceof e?t.addView(this,r):this}},{key:"insertBefore",value:function(t,r){var i=t.el||t;return i.parentNode.insertBefore(this.el,i),r&&t instanceof e&&t.owner?t.owner.addView(this,r):this}},{key:"insertAfter",value:function(t,r){var i=t.el||t;return i.nextSibling?this.insertBefore(i.nextSibling):i.parentNode.appendChild(this.el),r&&t instanceof e&&t.owner?t.owner.addView(this,r):this}},{key:"remove",value:function(t){if(!this.el.parentNode)throw new Error("View element is not in DOM");return this.el.parentNode.removeChild(this.el),t!==!1&&this.owner.removeView(this),this}},{key:"withdraw",value:function(){if(this._previousState)throw new Error("View is already withdrawn");return this._previousState={scrollTop:this.el.scrollTop(),parentNode:this.el.parentNode,placeholderEl:document.createElement("div")},this._previousState.parentNode.replaceChild(this._previousState.placeholderEl,this.el),this}},{key:"reinsert",value:function(){if(!this._previousState)throw new Error("View is not withdrawn");return this._previousState.parentNode.replaceChild(this.el,this._previousState.placeholderEl),this.el.scrollTop=this._previousState.scrollTop,this._previousState=null,this}},{key:"_setEnabled",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=e.recursive,i=void 0===r?!0:r,n=e.updateClass,s=void 0===n?!0:n,o=e.updateClassRecursive,a=void 0===o?!1:o,l=e.override,u=void 0===l?!1:l;if(u===!0?this.forceDisabled=!t:this.enabledInput=t,this.enabled=this.forceDisabled===!0?!1:this.enabledInput,s===!0&&(t===!0?this.classList.remove("disabled"):this.classList.add("disabled")),i===!0){var h=!0,c=!1,v=void 0;try{for(var f,d=this._viewsArray[Symbol.iterator]();!(h=(f=d.next()).done);h=!0){var y=f.value;y._setEnabled(t,{recursive:!0,updateClass:s&&a===!0,updateClassRecursive:a,override:u})}}catch(p){c=!0,v=p}finally{try{!h&&d.return&&d.return()}finally{if(c)throw v}}}return this}},{key:"enable",value:function(t){return this._setEnabled(!0,t)}},{key:"disable",value:function(t){return this._setEnabled(!1,t)}},{key:"show",value:function(){return this.hidden=!1,this.enable({updateClass:!1,override:!0}),this.classList.remove("hidden"),this}},{key:"hide",value:function(){return this.hidden=!0,this.disable({updateClass:!1,override:!0}),this.classList.add("hidden"),this}},{key:"hideAction",value:function(){return this.hide()}},{key:"listenTo",value:function(t,e,r){for(var i=0;i<this._listeners;i++){var n=this._listeners[i];if(n.object===t&&n.eventName===e&&n.callback===r)return this}return t.on(e,r),this._listeners.push({object:t,eventName:e,callback:r}),this}},{key:"stopListeningTo",value:function(t,e,r){for(var i=0;i<this._listeners;i++){var n=this._listeners[i];if(n.object===t&&n.eventName===e&&n.callback===r){n.object.off(n.eventName,n.callback),this._listeners.splice(i,1);break}}return this}},{key:"deconstruct",value:function(){if(this.owner)throw new Error("View may not be in view stack. Call remove() first.");var t=!0,e=!1,r=void 0;try{for(var i,n=this._listeners[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var s=i.value;s.object.off(s.eventName,s.callback)}}catch(o){e=!0,r=o}finally{try{!t&&n.return&&n.return()}finally{if(e)throw r}}var a=!0,l=!1,u=void 0;try{for(var h,c=this._viewsArray[Symbol.iterator]();!(a=(h=c.next()).done);a=!0){var v=h.value;v.deconstruct()}}catch(o){l=!0,u=o}finally{try{!a&&c.return&&c.return()}finally{if(l)throw u}}}},{key:"classList",get:function(){return this.el.classList}}]),e}(lrs.LRSObject),e=function(e){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,Object.getPrototypeOf(r).apply(this,arguments))}return _inherits(r,e),_createClass(r,[{key:"reset",value:function(t){if(!(t||this.content&&0!=this.content.length))return this;if(this.views.content||(this.views.content=[]),this.views.content.length){var e=!0,r=!1,i=void 0;try{for(var n,s=this.views.content[Symbol.iterator]();!(e=(n=s.next()).done);e=!0)view=n.value,view.owner=null,view.remove().deconstruct()}catch(o){r=!0,i=o}finally{try{!e&&s.return&&s.return()}finally{if(r)throw i}}this.views.content=[]}if(this.content=[],t)for(var a=0;a<t.length;a++)this._processObject(t[a],a);return this}},{key:"add",value:function(t,e){var r;return e===!0?r=0:e===!1?r=this.content.length:(r=this.indexForObject(e),0>r&&(r=this.content.length)),this._processObject(t,r),this}},{key:"remove",value:function(t){var e=this.indexForObject(t);return 0>e?this:(this.content.splice(e,1),this.views.content[e].owner=null,this.views.content[e].remove().deinitilize(),this.views.content.splice(e,1),this)}},{key:"sort",value:function(t){if(!t.length||!this.content)return this;var e=[],r=[],i=!0,n=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var l=o.value,u=this.content[this.indexForObject(l)];e.push(u),r.push(u.view)}}catch(h){n=!0,s=h}finally{try{!i&&a.return&&a.return()}finally{if(n)throw s}}this.content=e,this.views.content=r,this.withdraw();var c=!0,v=!1,f=void 0;try{for(var d,y=this.views.content[Symbol.iterator]();!(c=(d=y.next()).done);c=!0){var p=d.value;p.appendTo(this)}}catch(h){v=!0,f=h}finally{try{!c&&y.return&&y.return()}finally{if(v)throw f}}return this.reinsert(),this}},{key:"indexForObject",value:function(t){for(var e=0;e<this.content;e++)if(this.content[e].object===t)return e;return-1}},{key:"indexForView",value:function(t){for(var e=0;e<this.content;e++)if(this.content[e].view===t)return e;return-1}},{key:"viewForObject",value:function(t){var e=this.indexForObject(t);return 0>e?void 0:this.content[e].view}},{key:"_processObject",value:function(e,r){var n;if(e instanceof t?n=e:this.options.defaultChildClass?(n=new this.options.defaultChildClass(null,null),n.object=e):(n=new i(null,{template:this.options.defaultChildTemplate}),n.object=e),n.owner)throw new Error("View is already owned by a view");return n.owner=this,r===this.views.content.length?n.appendTo(this):n.insertBefore(this.views.content[r]),this.content.splice(r,0,{object:e,view:n}),this.views.content.splice(r,0,n),n}}]),r}(t),r=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),e}(t),i=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"object",set:function(t){this._object=t;var e=!0,r=!1,i=void 0;try{for(var n,s=Object.keys(this.outlets)[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var o=n.value,a=t[o];void 0!==a&&(this[o]=a)}}catch(l){r=!0,i=l}finally{try{!e&&s.return&&s.return()}finally{if(r)throw i}}},get:function(){return this._object}}]),e}(r);t.outletTypes={custom:{get:function(t,e){return t.get(e.el)},set:function(t,e,r){return t.set(e.el,r)}},input:{get:function(t){return"checkbox"===t.el.type?t.el.checked:t.el.value},set:function(t,e,r){return"checkbox"===t.el.type?t.el.checked=r?!0:!1:t.el.value=null!=r?r:""}},img:{get:function(t){return t.el.src},set:function(t,e,r){return t.el.src=null!=r?r||"":void 0}},html:{get:function(t){return t.el.innerHTML},set:function(t,e,r){return t.el.innerHTML=null!=r?r:""}}},t.outletTypes.default=t.outletTypes.html,t.outletTypes.textarea=t.outletTypes.input,t.views={LRSListView:e,LRSListItemView:r,LRSGeneratedListItemView:i},t.isTouch=null==document.ontouchstart,t.actionStringPattern=/^(.*?):([A-Za-z0-9_-]*)(\((.*?)\))?$/,window.lrs.LRSView=t}();